flowchart TD
    %% STIJLEN (Corporate & Clean)
    classDef soft fill:#E1F5FE,stroke:#0277BD,stroke-width:2px,color:#000;
    classDef hard fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,color:#000;
    classDef data fill:#FFF9C4,stroke:#FBC02d,stroke-width:2px,color:#000;
    classDef sim  fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,stroke-dasharray: 5 5,color:#000;

    %% --- DOMEIN 1: KIOSK (LINKS) ---
    subgraph Kiosk ["Kiosk (Frontend)"]
        direction TB
        NFC[NFC Reader]:::hard
        CamTab["Tablet camera"]:::hard
        App["Android App (Flutter)"]:::soft
        
        NFC -->|Badge ID| App
        CamTab -->|Aztec code| App
    end

    %% --- DOMEIN 2: BACKEND (MIDDEN) ---
    subgraph Backend ["Backend (Proxmox Server)"]
        direction TB
        API["FastAPI & WebSockets"]:::soft
        AIService["YOLOv26 AI Service"]:::soft
        PXE["PXE Live Boot Service"]:::soft
        DB[(PostgreSQL 17)]:::data
        Redis[(Redis Cache)]:::data
        
        API <-->|"Query / Log"| DB
        API <-->|"Pub/Sub"| Redis
        API <-->|"Analyze Image"| AIService
        API <-->|"Hardware Status"| PXE
    end

    %% --- DOMEIN 3: VISION BOX (RECHTS) ---
    subgraph Box ["Vision Box (Thin Client)"]
        direction TB
        RPi["Raspberry Pi / ESP32"]:::hard
        CamBox[Camera]:::hard
        Lock["Elektronisch slot"]:::hard
        
        CamBox -->|Photo| RPi
        RPi -->|"Open/Close"| Lock
    end

    %% --- SIMULATIE (ONDER) ---
    Sim["Digital Twin WebUI"]:::sim

    %% --- HOOFD VERBINDINGEN ---
    
    %% Kiosk praat met API
    App <-->|"HTTPS JSON<br/>(JWT Auth)"| API

    %% API praat met Box
    RPi <-->|"WSS & POST Image<br/>(Static API Key)"| API

    %% Simulatie test de API
    Sim -.->|"WSS (Virtuele Lockers)<br/>(Static API Key)"| API